1. 实验背景
在医疗拖行机器人的实际研发中，自动上下电梯是连接不同病区、实现全自动导航的核心闭环 。由于电梯环境复杂且属于非联网老旧设备，本项目通过“上位机决策 + 下位机执行”的架构，实现了机器人自主控制电梯 。

2. 技术实现
本实验核心代码 elevator_fsm.c 采用了有限状态机 (FSM) 设计模式，解决了传统逻辑在异常场景（如电梯门未开、蓝牙断连）下易死锁的问题。


硬件协同：由 STM32 接收上位机蓝牙指令，驱动舵机执行物理按压动作，模拟人工呼梯 。

软件架构：使用 C 语言编写，通过 6 个核心状态管理全流程，确保了逻辑的确定性与可维护性。


跨平台通信：实现了 Linux/ROS 上位机 与 STM32 底层 的高可靠性数据话题交换 。

3. 状态机模型说明

IDLE (空闲)：系统静默，监听上位机下发的电梯调度指令 。

APPROACHING (接近)：机器人移动至电梯门前识别区域。


WAITING_BTN (呼梯)：触发蓝牙通信，控制舵机按压上/下行按键 。


ENTERING (进梯)：检测门开状态，切换至高精度 IMU 纠偏模式驶入 。

IN_TRANSIT (驻留)：电梯运行中，实时监测楼层到达信号。


EXITING (出梯)：平层后安全退出电梯，回归导航主逻辑 。

4. 异常处理机制
系统内置了超时检测逻辑。如果在 WAITING_BTN 状态下超过 60 秒未检测到门开信号，FSM 将自动跳转回 IDLE 或重发蓝牙信号，避免机器人在电梯口盲目等待 。
